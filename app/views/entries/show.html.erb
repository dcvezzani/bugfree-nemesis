<style type="text/css">
  .onoffswitch-container{
    float: right; 
  }
</style>

<p id="notice"><%= notice %></p>

<p>
  <%= form_for @entry, url: trigger_work_timer_path(@entry), html: {class: "onoffswitch-container"} do |f| %>
  <div class="onoffswitch">
      <input type="hidden" name="onoffswitch" value="0">
      <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" <%= @entry.active_work_interval_exists? ? "checked" : "" %>>
      <label class="onoffswitch-label" for="myonoffswitch">
          <div class="onoffswitch-inner"></div>
          <div class="onoffswitch-switch"></div>
      </label>
  </div>
  <% end %>

  <b>Recorded for:</b>
  <%= @entry.recorded_for %>
</p>

<p>
  <b>Title:</b>
  <%= @entry.title %>
</p>

<p>
  <b>Yesterday's log:</b>
  <%= format_log(@entry.yesterdays_log) %>
</p>

<% if @entry.yesterdays_stories and @entry.yesterdays_stories.length > 0 %>
<ul>
<p>
  <p>Related stories (due date) ... (est / worked / todo):</p>
  <ul>
  <% @entry.yesterdays_stories.each do |story| %>
    <li><%= link_to "(#{format_date(story.due_on)}) #{story.title} : [#{story.hours_est} / #{story.hours_worked} / #{story.hours_todo}]", story %></li>
  <% end %>
  </ul>
</p>
</ul>
<% end %>

<p>
  <b>Today's Goals:</b>
  <%= format_log(@entry.todays_log) %>
</p>

<% if @entry.todays_stories and @entry.todays_stories.length > 0 %>
<ul>
<p>
  <p>Related stories (due date) ... (est / worked / todo):</p>
  <ul>
  <% @entry.todays_stories.each do |story| %>
    <li><%= link_to "(#{format_date(story.due_on)}) #{story.title} : [#{story.hours_est} / #{story.hours_worked} / #{story.hours_todo}]", story %></li>
  <% end %>
  </ul>
</p>
</ul>
<% end %>

<% if @entry.show_stopper_log and @entry.show_stopper_log.length > 0 %>
<p>
  <b>Show-stoppers:</b>
  <%= format_log(@entry.show_stopper_log) %>
</p>
<ul>
<p>
  <p>Show Stoppers:</p>
  <ul>
  <% @entry.show_stopper_stories.each do |story| %>
    <li><%= link_to "(#{format_date(story.due_on)}) #{story.title} : [#{format_date(story.stopped_since)}]", story %></li>
  <% end %>
  </ul>
</p>
</ul>
<% end %>

<% if @entry.notes and @entry.notes.length > 0 %>
<p>
  <b>Notes:</b>
<ul>
  <%= format_text(@entry.notes) %>
</ul>
</p>
<% end %>

<%= link_to 'Edit', edit_entry_path(@entry) %> |
<%= link_to 'Back', entries_path %>

<script type="text/javascript">
  $(document).ready(function(){
    $("#myonoffswitch").click(function(){
      $(".alert").fadeOut();
      var checkbox = $(this);

      // assumes the checkbox has already been updated
      current_state = $(checkbox).prop("checked");

      var form = $(checkbox).closest("form");
      var href = $(form).attr("action");
      var data = $(form).serialize();

      console.log("href: " + href);
      console.log("data: " + data);
      $.post(href, data, function(data){
        $(".alert-success").html(data["msg"]);
        $(".alert-success").fadeIn();
        // alert("success");
      }, "json")
      .fail(function(jqXHR, textStatus, errorThrown){
        $(checkbox).prop("checked", !current_state);
        data = JSON.parse(jqXHR.responseText);
        $(".alert-error").html(data["msg"]);
        $(".alert-error").fadeIn();
        // alert("error");
      });
    });
  })
</script>
